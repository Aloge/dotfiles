---
- name: Run task dependencies for uninstall Visual Studio Code app
  include_tasks: "{{ playbook_dir }}/lib/dependencies/{{ item }}.yml"
  loop:
    - os_is_mac
    - homebrew_is_installed

- block:
    - name: Ensure absence of Visual Studio Code app
      homebrew_cask:
        name: visual-studio-code
        state: absent
        install_options: force
      when: homebrew_is_installed

    - name: Ensure absence of files generated by Visual Studio Code
      file:
        path: '{{ item }}'
        state: absent
      loop:
        - '~/.vscode'
        - '~/Library/Application Support/Code'
        - '~/Library/Application Support/com.apple.sharedfilelist/com.apple.LSSharedFileList.ApplicationRecentDocuments/com.microsoft.vscode.sfl*'
        - '~/Library/Caches/com.microsoft.VSCode'
        - '~/Library/Caches/com.microsoft.VSCode.ShipIt'
        - '~/Library/Preferences/com.microsoft.VSCode.helper.plist'
        - '~/Library/Preferences/com.microsoft.VSCode.plist'
        - '~/Library/Saved Application State/com.microsoft.VSCode.savedState'
  when: os_is_mac
