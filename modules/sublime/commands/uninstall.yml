---
- name: Run task dependencies for uninstall Sublime Text app
  include_tasks: "{{ playbook_dir }}/lib/dependencies/{{ item }}.yml"
  loop:
    - os_is_mac
    - homebrew_is_installed

- block:
    - name: Ensure absence of Sublime Text app
      homebrew_cask:
        name: sublime-text
        state: absent
        install_options: force
      when: homebrew_is_installed

    - name: Ensure absence of files generated by Sublime Text
      file:
        path: '{{ item }}'
        state: absent
      loop:
        - /usr/local/Caskroom/sublime-text/
        - /usr/local/bin/subl
        - ~/Library/Application Support/Sublime Text 3
        - ~/Library/Caches/com.sublimetext.3
        - ~/Library/Preferences/com.sublimetext.3.plist
        - ~/Library/Saved Application State/com.sublimetext.3.savedState
  when: os_is_mac
